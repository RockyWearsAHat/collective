{"version":3,"file":"server.js","sources":["../server.ts"],"sourcesContent":["import { readFileSync } from \"fs\";\n\nimport { Hono } from \"hono\";\nimport { serve } from \"@hono/node-server\";\nimport { serveStatic } from \"@hono/node-server/serve-static\";\n\nimport apiRouter from \"./server/masterAPIRouter\";\n\n//If in production ts has been built to JS, must use index.html in build folder\nconst isProd = process.env[\"NODE_ENV\"] === \"production\";\nlet html = readFileSync(isProd ? \"build/index.html\" : \"index.html\", \"utf8\");\nlet parsedHTML = \"\";\n\nif (isProd) {\n  //Code to parse where the script tag that is being added is added, then remove it, however doesn't work because the script bundle includes all of the react code + the vite dev server\n  //God I love packing everything into one file\n  let scriptStartIndex = html.indexOf(\n    `<script type=\"module\" crossorigin src=\"/assets/index`\n  );\n  let scriptEndIndex = html.indexOf(`</script>`, scriptStartIndex);\n\n  console.log(scriptStartIndex, scriptEndIndex);\n\n  parsedHTML =\n    html.substring(0, scriptStartIndex) + html.substring(scriptEndIndex + 10);\n} else parsedHTML = html;\n\nconsole.log(parsedHTML);\n\nconst app = new Hono()\n  .use(\"/*\", serveStatic({ root: isProd ? \"build/\" : \"./\" })) //Serve the root folder, if running in dev serve base folder, if in prod serve build folder\n  .use(\"/*\", serveStatic({ root: \"public/\" })); //Serve images\n\napp.route(\"/api\", apiRouter);\n\napp.get(\"/*\", (c) => c.html(html));\n\nexport default app;\n\nif (isProd) {\n  serve({ ...app, port: 4000 }, (info) => {\n    console.log(`Listening on http://localhost:${info.port}`);\n  });\n}\n"],"names":["apiRouter"],"mappings":";;;;;;AAQA;AACA,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,YAAY,CAAC;AACxD,IAAI,IAAI,GAAG,YAAY,CAAC,MAAM,GAAG,kBAAkB,GAAG,YAAY,EAAE,MAAM,CAAC,CAAC;AAC5E,IAAI,UAAU,GAAG,EAAE,CAAC;AAEpB,IAAI,MAAM,EAAE;;;IAGV,IAAI,gBAAgB,GAAG,IAAI,CAAC,OAAO,CACjC,CAAA,oDAAA,CAAsD,CACvD,CAAC;IACF,IAAI,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,CAAW,SAAA,CAAA,EAAE,gBAAgB,CAAC,CAAC;AAEjE,IAAA,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;IAE9C,UAAU;AACR,QAAA,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,gBAAgB,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,cAAc,GAAG,EAAE,CAAC,CAAC;AAC9E,CAAC;;IAAM,UAAU,GAAG,IAAI,CAAC;AAEzB,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;AAExB,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE;KACnB,GAAG,CAAC,IAAI,EAAE,WAAW,CAAC,EAAE,IAAI,EAAE,MAAM,GAAG,QAAQ,GAAG,IAAI,EAAE,CAAC,CAAC;AAC1D,KAAA,GAAG,CAAC,IAAI,EAAE,WAAW,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,EAAE;AAE/C,GAAG,CAAC,KAAK,CAAC,MAAM,EAAEA,KAAS,CAAC,CAAC;AAE7B,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAInC,IAAI,MAAM,EAAE;AACV,IAAA,KAAK,CAAC,EAAE,GAAG,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,KAAI;QACrC,OAAO,CAAC,GAAG,CAAC,CAAA,8BAAA,EAAiC,IAAI,CAAC,IAAI,CAAE,CAAA,CAAC,CAAC;AAC5D,KAAC,CAAC,CAAC;AACL;;;;"}