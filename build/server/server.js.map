{"version":3,"file":"server.js","sources":["../../server/server.ts"],"sourcesContent":["import Express, { Response, Request } from \"express\";\n\nimport apiRouter from \"./masterAPIRouter\";\n\nimport cluster from \"cluster\";\nimport { cpus } from \"os\";\n\nexport const app = Express();\n\napp.use(Express.json());\napp.use(Express.urlencoded({ extended: true }));\n\napp.use(\"/api\", apiRouter);\n\nif (process.env !== undefined && process.env[\"VITE\"]) {\n  //If running in dev, just run the server from vite\n} else {\n  //If not running in dev, check how many threads and spawn workers\n  if (cluster.isPrimary) {\n    const numWorkers = cpus().length;\n    console.log(`Master cluster setting up ${numWorkers} workers...`);\n\n    for (let i = 0; i < numWorkers; i++) {\n      cluster.fork();\n    }\n\n    cluster.on(\"exit\", (worker, code, signal) => {\n      console.log(\n        `Worker ${worker.process.pid} died with code: ${code}, and signal: ${signal}`\n      );\n      console.log(\"Starting a new worker\");\n      cluster.fork();\n    });\n  } else {\n    if (!process.env[\"VITE\"]) {\n      const frontendFiles = process.cwd() + \"/build/\";\n      app.use(Express.static(frontendFiles));\n\n      app.get(\"/*\", (_: Request, res: Response) => {\n        res.sendFile(\"index.html\", { root: frontendFiles });\n      });\n      app.listen(process.env[\"PORT\"] ? process.env[\"PORT\"] : 4000);\n      console.log(\n        !process.env[\"PORT\"] ? \"Server started on http://localhost:4000\" : \"\"\n      );\n    }\n  }\n}\n"],"names":["apiRouter"],"mappings":";;;;;AAOa,MAAA,GAAG,GAAG,OAAO,GAAG;AAE7B,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AACxB,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;AAEhD,GAAG,CAAC,GAAG,CAAC,MAAM,EAAEA,MAAS,CAAC,CAAC;AAE3B,IAAI,OAAO,CAAC,GAAG,KAAK,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAErD;KAAM;;AAEL,IAAA,IAAI,OAAO,CAAC,SAAS,EAAE;AACrB,QAAA,MAAM,UAAU,GAAG,IAAI,EAAE,CAAC,MAAM,CAAC;AACjC,QAAA,OAAO,CAAC,GAAG,CAAC,6BAA6B,UAAU,CAAA,WAAA,CAAa,CAAC,CAAC;AAElE,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,EAAE,CAAC,EAAE,EAAE;YACnC,OAAO,CAAC,IAAI,EAAE,CAAC;SAChB;AAED,QAAA,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,KAAI;AAC1C,YAAA,OAAO,CAAC,GAAG,CACT,CAAA,OAAA,EAAU,MAAM,CAAC,OAAO,CAAC,GAAG,oBAAoB,IAAI,CAAA,cAAA,EAAiB,MAAM,CAAA,CAAE,CAC9E,CAAC;AACF,YAAA,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;YACrC,OAAO,CAAC,IAAI,EAAE,CAAC;AACjB,SAAC,CAAC,CAAC;KACJ;SAAM;QACL,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;YACxB,MAAM,aAAa,GAAG,OAAO,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC;YAChD,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC;YAEvC,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAU,EAAE,GAAa,KAAI;gBAC1C,GAAG,CAAC,QAAQ,CAAC,YAAY,EAAE,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC,CAAC;AACtD,aAAC,CAAC,CAAC;YACH,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC;AAC7D,YAAA,OAAO,CAAC,GAAG,CACT,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,yCAAyC,GAAG,EAAE,CACtE,CAAC;SACH;KACF;AACH;;;;"}